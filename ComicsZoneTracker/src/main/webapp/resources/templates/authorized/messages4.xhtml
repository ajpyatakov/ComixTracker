<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jsp/jstl/core">
<!--<c:if test="#{userRoleManagedBean.isUserAuthorized()}">-->
        <p:panel 
            id="messageAdder" 
            header="Your message" 
            styleClass="comments-container">
            <h:form id="messagesAdderForm">
                <p:inputTextarea 
                    id="messagesAdderNewMessage" 
                    style="width:100% ;"/>
                <br/>
                <p:commandButton 
                    id="messagesAdderSubmit" 
                    value="Send"
                    action="#{messagesManagedBean.addMessage()}"
                    update=":table :messageAdder"/>
            </h:form>
        </p:panel>
<!--    </c:if>-->


    <h:form id="table">
        <p:growl id="messagessMessage" showDetail="true" life="1000" />
        <p:confirmDialog
            message="Are you sure you want to delete comment?"
            header="Confirm action"
            widgetVar="deleteConfirm">
                
        </p:confirmDialog>
        <p:panel styleClass="comments-container">
            <p:dataTable var="message"
                    id="messages"
                    emptyMessage="No messages"
                paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} 
                    {CurrentPageReport} {NextPageLink} {LastPageLink}"
                    value="#{messagesManagedBean.dataModel}" 

                paginator="true" 
                rowsPerPageTemplate="10,20,30" 
                rows="10"
                lazy="true">
                <p:column width="30%"
                          sortBy="#{message.msgTime}" 
                          filterBy="#{message.text}" 
                          >
                    <p:panel id="messageid" 
                         header="#{message.sender.nickname}:#{message.msgTime}"
                         style="color: ;text-align: left; background-color: #{message.sender.userId eq messagesManagedBean.currentUser.userId ? '#B7FFFF' : '#C5FFD4'}">
                         <f:facet name="actions">
                            <p:commandLink
                                styleClass="ui-panel-titlebar-icon ui-corner-all 
                                ui-state-default ui-icon ui-icon-close"
                                action="#{messagesManagedBean.deleteMessage(message)}"
                                update=":table">
                            </p:commandLink>
                        </f:facet>
                        <p:graphicImage value="#{message.sender.avatarUrl}" width="100" height="100"/>
                        <h:outputText value="#{message.text}" />
                    </p:panel>
                </p:column>
        </p:dataTable>
        </p:panel>
    </h:form>
    
   
    

</ui:composition>
